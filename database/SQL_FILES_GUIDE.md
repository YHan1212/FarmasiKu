# SQL æ–‡ä»¶åˆ†ç±»å’Œæ¸…ç†æŒ‡å—

## ğŸ“‹ æ–‡ä»¶åˆ†ç±»

### âœ… **å¿…éœ€ä¿ç•™ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**

è¿™äº›æ–‡ä»¶æ˜¯åº”ç”¨è¿è¡Œæ‰€å¿…éœ€çš„ï¼Œ**ä¸è¦åˆ é™¤**ï¼š

#### 1. `schema.sql` â­ **æœ€é‡è¦**
- **ç”¨é€”**ï¼šåˆ›å»ºæ‰€æœ‰æ•°æ®åº“è¡¨ã€ç´¢å¼•ã€RLS ç­–ç•¥
- **ä½•æ—¶ä½¿ç”¨**ï¼šé¦–æ¬¡è®¾ç½®æ•°æ®åº“æ—¶è¿è¡Œ
- **ä¿ç•™**ï¼šâœ… **å¿…é¡»ä¿ç•™**

#### 2. `migrate_medications.sql` â­ **é‡è¦**
- **ç”¨é€”**ï¼šå°†è¯ç‰©æ•°æ®è¿ç§»åˆ°æ•°æ®åº“
- **ä½•æ—¶ä½¿ç”¨**ï¼šé¦–æ¬¡è®¾ç½®æ•°æ®åº“æ—¶è¿è¡Œ
- **ä¿ç•™**ï¼šâœ… **å¿…é¡»ä¿ç•™**

#### 3. `create_profile_trigger.sql` â­ **é‡è¦**
- **ç”¨é€”**ï¼šåˆ›å»ºè‡ªåŠ¨ç”Ÿæˆç”¨æˆ· profile çš„è§¦å‘å™¨
- **ä½•æ—¶ä½¿ç”¨**ï¼šè®¾ç½®æ•°æ®åº“æ—¶è¿è¡Œä¸€æ¬¡
- **ä¿ç•™**ï¼šâœ… **å¿…é¡»ä¿ç•™**

---

### ğŸ”§ **ä¿ç•™ï¼ˆç»´æŠ¤å’Œä¿®å¤ï¼‰**

è¿™äº›æ–‡ä»¶åœ¨éœ€è¦æ—¶å¾ˆæœ‰ç”¨ï¼Œå»ºè®®ä¿ç•™ï¼š

#### 4. `fix_registration_issues.sql`
- **ç”¨é€”**ï¼šä¿®å¤æ³¨å†Œå’Œç™»å½•é—®é¢˜ï¼ˆè§¦å‘å™¨ã€RLS ç­–ç•¥ï¼‰
- **ä½•æ—¶ä½¿ç”¨**ï¼šå½“æ³¨å†ŒåŠŸèƒ½å‡ºç°é—®é¢˜æ—¶
- **ä¿ç•™**ï¼šâœ… **å»ºè®®ä¿ç•™**ï¼ˆä½†å¯ä»¥ç§»åˆ° `maintenance/` æ–‡ä»¶å¤¹ï¼‰

#### 5. `quick_clear.sql`
- **ç”¨é€”**ï¼šå¿«é€Ÿæ¸…ç©ºæµ‹è¯•æ•°æ®
- **ä½•æ—¶ä½¿ç”¨**ï¼šæµ‹è¯•æ—¶æ¸…ç©ºæ•°æ®
- **ä¿ç•™**ï¼šâœ… **å»ºè®®ä¿ç•™**ï¼ˆä½†å¯ä»¥ç§»åˆ° `maintenance/` æ–‡ä»¶å¤¹ï¼‰

---

### ğŸ—‘ï¸ **å¯ä»¥åˆ é™¤ï¼ˆæµ‹è¯•/è¯Šæ–­ï¼‰**

è¿™äº›æ–‡ä»¶æ˜¯æµ‹è¯•å’Œè¯Šæ–­ç”¨çš„ï¼Œå¯ä»¥åˆ é™¤æˆ–ç§»åˆ°å•ç‹¬çš„æ–‡ä»¶å¤¹ï¼š

#### 6. `diagnose_registration.sql`
- **ç”¨é€”**ï¼šè¯Šæ–­æ³¨å†Œé—®é¢˜
- **ä½•æ—¶ä½¿ç”¨**ï¼šè°ƒè¯•æ—¶
- **ä¿ç•™**ï¼šâŒ **å¯ä»¥åˆ é™¤**ï¼ˆæˆ–ç§»åˆ° `debug/` æ–‡ä»¶å¤¹ï¼‰

#### 7. `check_trigger.sql`
- **ç”¨é€”**ï¼šæ£€æŸ¥è§¦å‘å™¨æ˜¯å¦å­˜åœ¨
- **ä½•æ—¶ä½¿ç”¨**ï¼šè°ƒè¯•æ—¶
- **ä¿ç•™**ï¼šâŒ **å¯ä»¥åˆ é™¤**ï¼ˆæˆ–ç§»åˆ° `debug/` æ–‡ä»¶å¤¹ï¼‰

#### 8. `check_users.sql`
- **ç”¨é€”**ï¼šæ£€æŸ¥ç”¨æˆ·å’Œ profiles
- **ä½•æ—¶ä½¿ç”¨**ï¼šè°ƒè¯•æ—¶
- **ä¿ç•™**ï¼šâŒ **å¯ä»¥åˆ é™¤**ï¼ˆæˆ–ç§»åˆ° `debug/` æ–‡ä»¶å¤¹ï¼‰

#### 9. `fix_missing_profiles.sql`
- **ç”¨é€”**ï¼šä¸ºç°æœ‰ç”¨æˆ·åˆ›å»ºç¼ºå¤±çš„ profiles
- **ä½•æ—¶ä½¿ç”¨**ï¼šä¸€æ¬¡æ€§ä¿®å¤
- **ä¿ç•™**ï¼šâŒ **å¯ä»¥åˆ é™¤**ï¼ˆå·²åŒ…å«åœ¨ `fix_registration_issues.sql` ä¸­ï¼‰

#### 10. `clear_all_users.sql`
- **ç”¨é€”**ï¼šæ¸…ç©ºæ‰€æœ‰ç”¨æˆ·æ•°æ®ï¼ˆè¯¦ç»†ç‰ˆæœ¬ï¼‰
- **ä½•æ—¶ä½¿ç”¨**ï¼šæµ‹è¯•æ—¶
- **ä¿ç•™**ï¼šâŒ **å¯ä»¥åˆ é™¤**ï¼ˆ`quick_clear.sql` æ›´ç®€æ´ï¼‰

---

## ğŸ¯ æ¨èçš„æ–‡ä»¶ç»“æ„

### æ–¹æ¡ˆ 1ï¼šä¿æŒç®€å•ï¼ˆæ¨èï¼‰

åªä¿ç•™æ ¸å¿ƒæ–‡ä»¶ï¼š

```
database/
â”œâ”€â”€ schema.sql                    âœ… ä¿ç•™
â”œâ”€â”€ migrate_medications.sql       âœ… ä¿ç•™
â”œâ”€â”€ create_profile_trigger.sql    âœ… ä¿ç•™
â””â”€â”€ quick_clear.sql              âœ… ä¿ç•™ï¼ˆæµ‹è¯•ç”¨ï¼‰
```

### æ–¹æ¡ˆ 2ï¼šç»„ç»‡åŒ–ï¼ˆæ›´æ•´æ´ï¼‰

åˆ›å»ºå­æ–‡ä»¶å¤¹åˆ†ç±»ï¼š

```
database/
â”œâ”€â”€ core/                        # æ ¸å¿ƒæ–‡ä»¶
â”‚   â”œâ”€â”€ schema.sql
â”‚   â”œâ”€â”€ migrate_medications.sql
â”‚   â””â”€â”€ create_profile_trigger.sql
â”œâ”€â”€ maintenance/                 # ç»´æŠ¤è„šæœ¬
â”‚   â”œâ”€â”€ fix_registration_issues.sql
â”‚   â””â”€â”€ quick_clear.sql
â””â”€â”€ debug/                       # è°ƒè¯•è„šæœ¬ï¼ˆå¯é€‰ï¼‰
    â”œâ”€â”€ diagnose_registration.sql
    â”œâ”€â”€ check_trigger.sql
    â””â”€â”€ check_users.sql
```

---

## ğŸ§¹ æ¸…ç†å»ºè®®

### ç«‹å³å¯ä»¥åˆ é™¤çš„æ–‡ä»¶ï¼š

1. âŒ `diagnose_registration.sql` - è¯Šæ–­ç”¨ï¼Œå·²ä¸éœ€è¦
2. âŒ `check_trigger.sql` - æ£€æŸ¥ç”¨ï¼Œå·²ä¸éœ€è¦
3. âŒ `check_users.sql` - æ£€æŸ¥ç”¨ï¼Œå·²ä¸éœ€è¦
4. âŒ `fix_missing_profiles.sql` - å·²åŒ…å«åœ¨ `fix_registration_issues.sql` ä¸­
5. âŒ `clear_all_users.sql` - `quick_clear.sql` æ›´ç®€æ´

### å»ºè®®ä¿ç•™çš„æ–‡ä»¶ï¼š

1. âœ… `schema.sql` - **å¿…éœ€**
2. âœ… `migrate_medications.sql` - **å¿…éœ€**
3. âœ… `create_profile_trigger.sql` - **å¿…éœ€**
4. âœ… `fix_registration_issues.sql` - ç»´æŠ¤ç”¨
5. âœ… `quick_clear.sql` - æµ‹è¯•ç”¨

---

## ğŸ“ æ¸…ç†åçš„æœ€å°æ–‡ä»¶é›†

æ¸…ç†åï¼Œ`database/` æ–‡ä»¶å¤¹åº”è¯¥åªåŒ…å«ï¼š

```
database/
â”œâ”€â”€ schema.sql                    # æ•°æ®åº“æ¶æ„
â”œâ”€â”€ migrate_medications.sql       # è¯ç‰©æ•°æ®
â”œâ”€â”€ create_profile_trigger.sql    # ç”¨æˆ·è§¦å‘å™¨
â”œâ”€â”€ quick_clear.sql              # æ¸…ç©ºæµ‹è¯•æ•°æ®ï¼ˆå¯é€‰ï¼‰
â””â”€â”€ [æ–‡æ¡£æ–‡ä»¶ .md]               # å„ç§æŒ‡å—
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¸è¦åˆ é™¤ `schema.sql`**ï¼šè¿™æ˜¯æ•°æ®åº“çš„åŸºç¡€æ¶æ„
2. **ä¸è¦åˆ é™¤ `migrate_medications.sql`**ï¼šåŒ…å«è¯ç‰©æ•°æ®
3. **ä¸è¦åˆ é™¤ `create_profile_trigger.sql`**ï¼šç”¨æˆ·æ³¨å†Œéœ€è¦å®ƒ
4. **å¤‡ä»½é‡è¦æ•°æ®**ï¼šåˆ é™¤å‰ç¡®ä¿æ•°æ®åº“å·²æ­£ç¡®è®¾ç½®
5. **Supabase SQL Editor**ï¼šè¿™äº›æ–‡ä»¶åªæ˜¯æœ¬åœ°å‰¯æœ¬ï¼Œåˆ é™¤ä¸ä¼šå½±å“ Supabase ä¸­çš„å®é™…æ•°æ®åº“

---

## ğŸš€ å¿«é€Ÿæ¸…ç†å‘½ä»¤

å¦‚æœä½ æƒ³å¿«é€Ÿæ¸…ç†ï¼Œå¯ä»¥åˆ é™¤è¿™äº›æ–‡ä»¶ï¼š

- `diagnose_registration.sql`
- `check_trigger.sql`
- `check_users.sql`
- `fix_missing_profiles.sql`
- `clear_all_users.sql`

ä¿ç•™è¿™äº›æ–‡ä»¶ï¼š

- `schema.sql`
- `migrate_medications.sql`
- `create_profile_trigger.sql`
- `fix_registration_issues.sql`ï¼ˆç»´æŠ¤ç”¨ï¼‰
- `quick_clear.sql`ï¼ˆæµ‹è¯•ç”¨ï¼‰

